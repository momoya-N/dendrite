\usepackage{lmodern}
\usepackage[T1]{fontenc}

% フォントの設定
%\usepackage[ipaex]{pxchfon}
\usepackage[haranoaji]{pxchfon}

\usepackage{lipsum} % ダミーテキスト


\usepackage{ifdraft}
\ifdraft{\usepackage{showkeys}}{}  % draftモードのときのみ参照キー表示
\usepackage{docmute} % ファイル分割
\usepackage{multicol} % 多段組
\usepackage[fleqn]{amsmath} % fleqn:数式の左寄せ, leqno:数式番号の左寄せ（(section番号).(数式番号)に書き換えるとalignなどで改行が入ってしまう）
\usepackage{amsthm}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{mathrsfs} % 筆記体・花文字

\usepackage{bm}
\usepackage{mathtools}
\usepackage[inline]{enumitem} % 箇条書きなど
% \usepackage{url} 
%\usepackage{here} % 表などをその場所に表示させる\begin{figure}[H] (hoge) \end{figure}

\usepackage{ifthen}
\usepackage{pgffor}

% biblatex
\usepackage[backend=biber,style=numeric,sorting=none]{biblatex}
% .bibファイルの指定
% \addbibresource{../Reference/references.bib}
% \input{../Reference/biblatex.cfg}


%\usepackage[verbose]{backref}
%\backrefsetup{verbose=false}
%\ifthenelse{\boolean{luatex}}{\usepackage[unicode,pdfusetitle]{hyperref}}{\usepackage[pdfusetitle,backref=page]{hyperref}}
\ifthenelse{\boolean{luatex}}{\usepackage[unicode,pdfusetitle]{hyperref}}{\usepackage[pdfusetitle]{hyperref}}
\usepackage[dvipsnames]{xcolor}
\hypersetup{
  colorlinks=true,
  citecolor=violet,
  linkcolor=teal,
  urlcolor=orange,
}

%%%% 数式フォントの変更
%\usepackage{newtxtext,newtxmath}
%%%%

\usepackage{mleftright} % 括弧の調整
\usepackage{exscale} % 異なるフォントサイズでの大型演算子のサポート
% \usepackage[framemethod = tikz, roundcorner = 5pt, linewidth = 3pt]{mdframed} % 囲み環境
\let\oldcdot\cdot
\usepackage{breqn}
\let\cdot\oldcdot

%\usepackage{siunitx}

\usepackage{tikz}
\usetikzlibrary{intersections, calc, arrows, cd}
% \usepackage{tikz-3dplot}

% \usepackage{empheq}  % 場合分け

% \usepackage{subfig} % subfigure環境

% \usepackage{adjustbox} % 図のサイズ調整

% \usepackage{diagbox} % 表中で斜線を表示
% \usepackage{lscape} % landscape環境を有効化

%\usepackage{prooftrees} % 証明木

%\newcommand{\pdiff}[3][]{\frac{\partial^{#1} {#2}}{\partial {#3}^{#1}}} % 偏微分
\newcommand{\pdiff}[2]{%
\newcount\pdifftempcount%
\pdifftempcount0%
\foreach\variable in{#2}{\global\advance\pdifftempcount1}%
\frac{\partial\ifnum\pdifftempcount>1{^{\the\pdifftempcount}}\fi{#1}}{%
\def\pdifftempx{\relax}%
\newcount\pdiffloopcount%
\def\pdifftempname{\relax}%
\foreach\variable in{#2,\relax}{%
    \ifthenelse{\equal{\pdifftempx}{\variable}}{\global\advance\pdiffloopcount1}%
    {%
      \ifthenelse{\NOT\equal{\pdifftempname}{\relax}}{%
        \ifnum\pdiffloopcount=1{\partial\pdifftempname}%
        \else{\partial\pdifftempname^{\the\pdiffloopcount}}\fi%
      }{\relax}%
      \global\newcount\pdiffloopcount%
      \global\pdiffloopcount1%
      \global\let\pdifftempname\variable%
      \global\def\pdifftempx{\pdifftempname}%
    }%
  }%
}%
}
\newcommand{\substitute}[2]{\mleft. #1 \mright|_{\substack{#2}}} % 代入
\newcommand{\Res}[2]{\underset{#2}{\mathrm{Res}}\pare{#1}} % 留数

\newcommand{\ele}{\bm{e}} % 単位ベクトル
\newcommand{\N}{\mathbb{N}} % 自然数全体
\newcommand{\Z}{\mathbb{Z}} % 整数全体
\newcommand{\Q}{\mathbb{Q}} % 有理数全体
\newcommand{\R}{\mathbb{R}} % 実数全体
\newcommand{\CC}{\mathbb{C}} % 複素数全体

\newcommand{\pmat}[1]{\mleft(\begin{matrix} #1 \end{matrix}\mright)} % 括弧付きの行列
\newcommand{\mat}[1]{\begin{matrix} #1 \end{matrix}} % 括弧なしの行列
\newcommand{\vctr}[1]{\mleft(\begin{matrix} #1 \end{matrix}\mright)} % ベクトル(縦なら\vctr{a\b\c}，横なら\vctr{a&b&c}のように)
\DeclareMathOperator{\sgn}{\mathrm{sgn}} % 符号sgn

\newcommand{\trans}[1]{{}^t{#1}} % 転置

\newcommand{\spare}[1]{(#1)} % 小括弧
\newcommand{\pare}[1]{\mleft( #1 \mright)} % 括弧
\newcommand{\bra}[1]{\mleft\{ #1 \mright\} } % 中括弧
\newcommand{\squ}[1]{\mleft[ #1 \mright]} % 大括弧
\newcommand{\norm}[1]{\mleft\|#1\mright\|} %ノルム記号
%\newcommand{\bsqu}[1]{\Bigl[ #1 \Bigr]} %大括弧 (積分などで強制的に大きくしたい場合)
\newcommand{\bsqu}[1]{\squ{\vphantom{\frac{1}{2}}#1}} %大括弧 (積分などで強制的に大きくしたい場合)
\newcommand{\bsl}[2]{\mleft. {#1}\, \middle/ \, {#2}\mright.} %大きなスラッシュ

\newcommand{\case}[2][cl]{
  \mleft\{
  \begin{aligned}
    \begin{array}{#1}
      #2
    \end{array}
  \end{aligned}
  \mright.
}
\newcommand{\abs}[1]{\mleft|#1\mright|} % 絶対値
\newcommand{\card}[1]{\mleft|#1\mright|} % 集合の濃度(個数)

\newcommand{\relmiddle}[1]{\mathrel{}\middle#1\mathrel{}} % 集合の縦棒
\newcommand{\set}[2]{\mleft\{ \rule{0pt}{10pt} \, #1 \relmiddle{|} #2\, \mright\}} % 集合
\newcommand{\sset}[2]{\mleft\{ #1 \relmiddle{|} #2\mright\}} % 集合
\newcommand{\seq}[2]{\mleft\{#1\mright\}_{#2}} % 数列
\newcommand{\fset}[2]{\mleft\{#1\mright\}_{#2}} % 集合族
\newcommand{\gene}[1]{\mleft\langle #1 \mright\rangle} % 生成
\newcommand{\expe}[1]{\mleft\langle #1 \mright\rangle} % 期待値

\newcommand{\defarrow}{\stackrel{\mathrm{def}}{\Longleftrightarrow}} % 定義矢印(同値矢印の上にdef)
\DeclareMathOperator{\ord}{\mathrm{ord}} % 元の位数

\newcommand{\SL}[2]{\mathrm{SL}_{#1}\pare{#2}} % 特殊線形群
\newcommand{\GL}[2]{\mathrm{GL}_{#1}\pare{#2}} % 一般線形群
\newcommand{\id}[1]{\mathrm{id}_{#1}} % 恒等写像
\newcommand{\Mat}[3]{\mathrm{Mat}\pare{#1,#2,#3}}
\newcommand{\fun}[2]{#1 \pare{#2}} % 関数
\newcommand{\sfun}[2]{#1 (#2)} % 関数
\newcommand{\Laplace}[1]{\mathcal{L}\mleft[ #1 \mright]} % Laplace変換
\newcommand{\Fourier}[1]{\mathcal{F}\mleft[ #1 \mright]} % Fourier変換

\newcommand{\Orthogonal}[2]{\sfun{\mathrm{O}_{#1}}{#2}} % 一般線形群


\newcommand{\Gauss}[4]{{}_2F_1\mleft[\mleft.
    \begin{matrix}
      #1, #2
      \\
      #3
    \end{matrix}\,
    \mright|\
    #4\,
    \mright]
} % Gaussの超幾何函数

\newcommand{\Kummer}[3]{{}_1F_1\mleft[\mleft.
    \begin{matrix}
      #1
      \\
      #2
    \end{matrix}\,
    \mright|\
    #3\,
    \mright]
} % Kummerの合流型超幾何函数

\newcommand{\pfq}[5]{{}_{#1}F_{#2}\mleft[\mleft.
  \begin{matrix}
    #3
    \\
    #4
  \end{matrix}\,
  \mright|\
  #5\,
  \mright]
} % 一般化超幾何函数

\newcommand{\sGauss}[4]{{}_{2}F_{1}\mleft({#1},\, {#2}\,;\, {#3}\, ;\, {#4}\mright)} % インライン用のGaussの超幾何函数
\newcommand{\sKummer}[3]{{}_{2}F_{1}\mleft({#1}\,;\, {#2}\, ;\, {#3}\mright)} % インライン用のKummerの合流型超幾何函数
\newcommand{\spfq}[5]{{}_{#1}F_{#2}\mleft({#3}\,;\, {#4}\, ;\, {#5}\mright)} % インライン用の一般化超幾何函数

\newcommand{\poch}[2]{\mleft(#1\mright)_{#2}} % Pochhammer記号

\newcommand{\Poch}[2]{\frac{\Gamma\mleft(#1+#2\mright)}{\Gamma\mleft(#1\mright)}} % Pochhammer記号(Gamma函数表示)


\DeclareMathOperator{\cosech}{\mathrm{cosech}} % 1/sinh
\DeclareMathOperator{\limn}{\lim_{\mathit{n}\to\infty}} % lim_{n\to\infty}の略記

\newcommand{\Li}[2]{\mathrm{Li}_{#1}\mleft(#2\mright)} % 多重対数函数

\newcommand{\re}[1]{\mathrm{Re}\mleft(#1\mright)} % 実部
\newcommand{\im}[1]{\mathrm{Im}\mleft(#1\mright)} % 虚部

\newcommand{\inner}[2]{\mleft\langle #1 \middle| #2 \mright\rangle} % 内積
\newcommand{\Bra}[1]{\mleft\langle #1\middle|\mright.}
\newcommand{\Ket}[1]{\mleft. \middle| #1 \mright\rangle}

\newcommand{\diffun}[3]{{#1}^{\mleft({#2}\mright)}\mleft({#3}\mright)} % w^{(n)}(z) のような表記

\DeclareRobustCommand{\stir}{\genfrac\{\}{0pt}0} % 第1種Stirling数
\DeclareRobustCommand{\sstir}{\genfrac\{\}{0pt}1} % 第1種Stirlling数（インライン用）

\newcommand{\Schrodinger}{Schr\"odinger}
\DeclareMathOperator{\laplacian}{\triangle}

\newcommand{\dummy}{\,\cdot\,} % ダミーのドット

%\newcommand{\dx}[2][{}]{\mathrm{d}^{#1}#2}
% \newcommand{\dx}[2][{}]{\mathrm{d}^{#1}\ifthenelse{\equal{#1}{}}{\hspace{-0.025em}}{\relax}{#2}}
\newcommand{\dx}[2][{}]{d^{#1}{#2}}
\newcommand{\diff}[3][]{\frac{\dx[#1]{#2}}{\dx{#3}^{#1}}} % 常備分
\newcommand{\Hami}{\mathcal{H}}


% 順序対
\newcommand{\opair}[2]{\pare{#1,#2}}
\newcommand{\opairn}[1]{\pare{#1}}

\newcommand{\functional}[2]{#1 \squ{#2}} % 汎関数
\newcommand{\Fdiff}[2]{\frac{\delta #1}{\delta #2}} % 汎関数微分

\newcommand{\ointerval}[2]{(#1, #2)} % 開区間
\newcommand{\cointerval}[2]{(#1, #2]} % 半開区間
\newcommand{\ocinterval}[2]{[#1, #2)} % 半開区間
\newcommand{\cinterval}[2]{[#1, #2]} % 閉区間


% ベクトル解析
\newcommand{\grad}[1]{\bm{\nabla} #1} % 勾配
\newcommand{\divergence}[1]{\bm{\nabla} \cdot #1} % 発散
\newcommand{\rot}[1]{\bm{\nabla} \times #1} % 回転

% 位相空間
\newcommand{\Orb}[1]{\fun{\mathrm{Orb}}{#1}} % 軌道

\newcommand{\Fix}[1]{\fun{\mathrm{Fix}}{#1}} % 不動点集合
\newcommand{\Per}[1]{\fun{\mathrm{Per}}{#1}} % 周期点集合
\newcommand{\CR}[1]{\fun{\mathrm{CR}}{#1}} % 周期点集合


% 関数解析
\newcommand{\closure}[1]{\overline{#1}} % 閉包

\newcommand{\Frechet}{Fr\'echet\relax}
\newcommand{\Holder}{H\"older\relax}

\newtheoremstyle{mystyle}%   % スタイル名
{}%                      % 上部スペース
{}%                      % 下部スペース
{\normalfont}%           % 本文フォント
{}%                      % インデント量
{\textbf}%                   % 見出しフォント
{}%                      % 見出し後の句読点, '.'
{ }%                     % 見出し後のスペース, ' ' or \newline
{\underline{\thmname{#1}\thmnumber{#2}\thmnote{（#3）}}}%
% 見出しの書式 (can be left empty, meaning `normal')
\theoremstyle{mystyle} % スタイルの適用

% 定理環境の定義
\theoremstyle{definition}
\newtheorem{prob}{問}[chapter]
\newtheorem{thm}{定理}[chapter]
\newtheorem{defi}[thm]{定義}
\newtheorem{lem}[thm]{補題}
\newtheorem{rem}[thm]{注意}
\newtheorem{cor}[thm]{系}
\newtheorem{eg}[thm]{例}
\newtheorem{req}[thm]{要請}
\newtheorem{prop}[thm]{命題}
\newtheorem{nota}[thm]{記法}
\newtheorem{supple}[thm]{補足}
\newtheorem*{policy}{方針}

\newtheorem{pri}[thm]{公理}

% proof環境修正
\renewcommand{\proofname}{証明}
\makeatletter
\renewenvironment{proof}[1][\proofname]{\par
  \pushQED{\qed}%
  \normalfont \topsep6\p@\@plus6\p@\relax
  \trivlist
  \item[\hskip\labelsep
              \bfseries
              #1\@addpunct{.}]\ignorespaces
}{%
  \popQED\endtrivlist\@endpefalse
}
\makeatother

% showonlyrefsはwtrefやcleverefと相性が悪いので使わない
%\mathtoolsset{showonlyrefs=true} % 式番号を参照されたもののみ付ける

\usepackage{wtref} % 相互参照支援
% キーの定義
\newref{part,chap,app,sec,subsec,subsubsec}
\newref{equ,tab,fig}
\newref{thm,prob,defi,lem,rem,cor,eg,req,prop,nota,supple}

\newref{item}

\newref{pri}

\newref{appsec, appsubsec}


% 参照名の定義
\setrefstyle{part}{suffix=部}
\setrefstyle{chap}{suffix=章}
\setrefstyle{app}{prefix=付録}
\setrefstyle{sec}{suffix=節}
\setrefstyle{subsec}{suffix=項}
\setrefstyle{subsubsec}{suffix=目}

\setrefstyle{equ}{refcmd=(\ref{#1}), prefix=式}
\setrefstyle{tab}{prefix=表}
\setrefstyle{fig}{prefix=図}

\setrefstyle{prob}{prefix=問}
\setrefstyle{thm}{prefix=定理}
\setrefstyle{defi}{prefix=定義}
\setrefstyle{lem}{prefix=補題}
\setrefstyle{rem}{prefix=注意}
\setrefstyle{cor}{prefix=系}
\setrefstyle{eg}{prefix=例}
\setrefstyle{req}{prefix=要請}
\setrefstyle{prop}{prefix=命題}
\setrefstyle{nota}{prefix=記法}
\setrefstyle{supple}{prefix=補足}
\setrefstyle{pri}{prefix=原理}

\setrefstyle{appsec}{prefix=付録, suffix=節}
\setrefstyle{appsubsec}{prefix=付録, suffix=項}


% 問題と解答の連動
\def\ans#1{\vspace{5pt}\par\noindent\textbf{問\ref{prob:#1}.}}
\def\endans{\vspace{5pt}\par}


\if0
  % 式参照した場合auxに書き込み（これをしないと\mathtoolsset{showonlyrefs=true}と共存できない）
  \makeatletter
  \let\xx@temp\equref
  \def\equref#1{\xx@temp{#1}%
    \immediate\write\@auxout{\string\MT@newlabel{equ:#1}}}
  \makeatother
\fi


% 式番号をchapterごとにつける
\makeatletter
\@addtoreset{equation}{chapter}
\def\theequation{\thechapter.\arabic{equation}}
% 表, 図番号をchapterごとにつける
\@addtoreset{table}{chapter}
\def\thetable{\thechapter.\arabic{table}}
\@addtoreset{figure}{chapter}
\def\thefigure{\thechapter.\arabic{figure}}
\makeatother

\if0
  % 式番号をsectionごとにつける
  \makeatletter
  \@addtoreset{equation}{section}
  \def\theequation{\thesection.\arabic{equation}}
  % 表, 図番号をsectionごとにつける
  \@addtoreset{table}{section}
  \def\thetable{\thesection.\arabic{table}}
  \@addtoreset{figure}{section}
  \def\thefigure{\thesection.\arabic{figure}}
  \makeatother
\fi


% \parindent = 0pt
\allowdisplaybreaks[1] % 数式途中の改ページを許すかどうか(0:許さない, 1~3:値が大きいほど規制がゆるい)


% 余白の設定
\setlength{\textwidth}{\fullwidth}
\setlength{\evensidemargin}{\oddsidemargin}


% \setcounter{tocdepth}{4}  % subsubsectionまで表示
\setcounter{tocdepth}{3}  % subsectionまで表示


% argmax, argmin
\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}

% 空間次元
\newcommand{\dime}{\mathcal{D}}

% メモ
\newcommand{\note}[1]{\ifdraft{\footnote{\textcolor{blue}{#1}}}{\relax}}
% \newcommand{\todo}[1]{\ifdraft{\textcolor{red}{TODO: #1}}{\relax}}
\newcommand{\todo}[1]{\textcolor{red}{TODO: #1}}

% オーダー
\newcommand{\order}[1]{\sfun{o}{#1}}
\newcommand{\Order}[1]{\sfun{O}{#1}}
\newcommand{\Trder}[1]{\sfun{\Theta}{#1}}

% 一般の冪のオーダー記号
\newcommand{\oXa}[1]{\sfun{o}{V^{#1}}}
\newcommand{\OrderXa}[1]{\sfun{O}{V^{#1}}}
\newcommand{\OXa}[1]{\sfun{\Theta}{V^{#1}}}

% 差分
\newcommand{\vDel}[1]{\varDelta\hspace{0.5pt}{#1}}

% 波括弧が小さいままの数列
\newcommand{\sseq}[2]{{\{#1\}}_{#2}}

% 順序対
\newcommand{\pair}[2]{\pare{#1,#2}}
\newcommand{\spair}[2]{\spare{#1,#2}}

% 行列の要素を displaystyle に
\usepackage{etoolbox}
\AtBeginEnvironment{matrix}{\everymath{\displaystyle}}
\AtBeginEnvironment{pmatrix}{\everymath{\displaystyle}}
\AtBeginEnvironment{bmatrix}{\everymath{\displaystyle}}
